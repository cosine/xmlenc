require 'saml'
saml_response = "PHNhbWxwOlJlc3BvbnNlIElEPSJfNjI0N2E2NDMtMjg5Yy00NDJmLTkwNWYtMGNkZWZlYTg4MjZlIiBWZXJzaW9uPSIyLjAiIElzc3VlSW5zdGFudD0iMjAxNi0wMS0wN1QxODoyOTo1OC43NFoiIERlc3RpbmF0aW9uPSJodHRwczovL3FhMi5oZWFsdGh0YXAuY29tL3Nzby9zZXNzaW9ucy9hc3NlcnRpb25fY29uc3VtZXJfc2VydmljZSIgQ29uc2VudD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmNvbnNlbnQ6dW5zcGVjaWZpZWQiIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiPjxzYW1sOklzc3VlciB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj50ZXN0LmhlYWx0aGVxdWl0eS5jb20uc2FtbDI8L3NhbWw6SXNzdWVyPjxzYW1scDpTdGF0dXM+PHNhbWxwOlN0YXR1c0NvZGUgVmFsdWU9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpzdGF0dXM6U3VjY2VzcyIgLz48L3NhbWxwOlN0YXR1cz48c2FtbDpFbmNyeXB0ZWRBc3NlcnRpb24geG1sbnM6c2FtbD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+PEVuY3J5cHRlZERhdGEgVHlwZT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjRWxlbWVudCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jIyI+PEVuY3J5cHRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNhZXMyNTYtY2JjIiAvPjxLZXlJbmZvIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj48RW5jcnlwdGVkS2V5IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyMiPjxFbmNyeXB0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjcnNhLTFfNSIgLz48S2V5SW5mbyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PFg1MDlEYXRhPjxYNTA5Q2VydGlmaWNhdGU+TUlJRUh6Q0NBd2NDQ1FEZjdyd0tVbm1xV0RBTkJna3Foa2lHOXcwQkFRVUZBREE5TVNFd0h3WURWUVFMRXhoRWIyMWhhVzRnUTI5dWRISnZiQ0JXWVd4cFpHRjBaV1F4R0RBV0JnTlZCQU1NRHlvdWFHVmhiSFJvZEdGd0xtTnZiVEFlRncweE5URXhNREl3T0RFeE5USmFGdzB4TnpFeE1ERXdPREV4TlRKYU1HWXhDekFKQmdOVkJBWVRBbFZUTVFzd0NRWURWUVFJREFKRFFURVNNQkFHQTFVRUJ3d0pVR0ZzYnkxQmJIUnZNUkl3RUFZRFZRUUtEQWxJWldGc2RHaDBZWEF4SWpBZ0JnTlZCQU1NR1hkbFluTmxjblpwWTJWekxtaGxZV3gwYUhSaGNDNWpiMjB3Z2dJaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQ0R3QXdnZ0lLQW9JQ0FRQ3ZxUVlGVDQvU0FhSGdOWk9SSzloeEVFeG0xS1pNeTdQMGoxbjlSWC9COUd4WVZEWGZnSGhMdlljSzRZU2xZTmlWY3UzNnB5eHNOS2JzYXFOZ3krSlIzN2xGV3p4eEJXNEVlV3oyM2MvUWpDSXFCRlZ4Y1FaS1g5bGJRU2k3UkdIbE9MOENGeHlKdUlPM0ttdmhYYjJDRkw1cS90TDNqTkdqWVFEVDlUMk9idG1yazZoQ0RKSlI3TS9LMnRYaUNnZEZKdnhnQk10ZS96RVZib093dGNVMkVNSUVSOFl2RUkvdUJ5MlFrUzBadGRzUjl3c0VCVE16eEl4QnJtQ2FHNCtON3E4dmpPN252cFRtcjlhcldOVGNXR3VtTlV5NFp3d2pBUlBCeHJDNHc1MWJJRlRyYVJudHVJaDhnN0RDQ1RMMTFvQldXWTUwc1BLTjNKTlBNck1yMFBpZHFGQ0lGakFhU0dpTlBiN3QxVkc3K2o5Rkk0bzZRZXdTS2lmcDZqMmJyWnhCbUVJVTliTlBWN3pDd25jS1FqeFdPcU1xUHc1bnBBcmN5bkg4QTlvYzhsZi94R3pEdWpFSktHSmQraFpMTGwxVXVwT2pEbTBKRWlkNmlHMndGWURXNHlaTkdQak51VkIrTXliNmZ1R3pxaWhEVEozdWY2K1l2UW5FaXRmVW43VTNjKzNYVGVVeEYzTGtQbjJxWkdoRElQTFNYcVJoUHBVZXJlMVNrVFltVzFUOEpZNndhRHhlckdzaUFteTNtR29EdnA4ZzhVY2lIRkFYdGhwUHhwUUVQQzJma0FidzZjYWhIbld3RFErYUNVRHdXcFJjYWowaENxQUhCWmtZaEtHR1ZjOVEzUGVQcDlZY0k5aHQ4SHZmUlBTZFlLQjE5bzhTdmEyaStRSURBUUFCTUEwR0NTcUdTSWIzRFFFQkJRVUFBNElCQVFCbytNWnJlVTdzT3VWa0NOYWZ1QVVjeXpvYWo5c1FZVUdxbXpIc1J1T1ZkcG81cElCMkVFTXhUODh5Y2RVRVFwZGZ1V2NtZWw4MXRkUCtFa29HTmlTdzJNSWY0QitTQjlTSExNSjBrc3VqelkySmUxSjhBSklvOFRyNWQwcmdYcUwyY09KQ3RWaVdnWEtRRHMwUThUY3hKNTZZRHJSNURwbFpRYjN2Y2dnWnlkZVR1Sy9pTENWOS9ISHdoLzFzNVVQRUFzZEJHd1czUHQ2QTRMNkg5OHNQQmlJdFRLUVBtbEZ3T1JLRm5kYUIzdnlGMHg1V0tIczI2VTdOYU02QjhlWVlNdmlTNG4zSTRrRUFoVEw1N0N0U1d5eEJWKzBiTit3R1hlQUxYQWNUNmRsb1Y4RHlrNVJBRC8xd003Uk9IMGRjUnBSNld5Q25xTFNPWm9iNUN5UWg8L1g1MDlDZXJ0aWZpY2F0ZT48L1g1MDlEYXRhPjwvS2V5SW5mbz48Q2lwaGVyRGF0YT48Q2lwaGVyVmFsdWU+Y3A2NjRWek53S29jUW9yRVFNLzZ0UldzVGdTY0dmQ2tCRmpveU9ieGMwWENTM0cxMDVSU29QRnR6eEczZld5U1dVR3JKNW13SElrbExzY09tYks2VjlWSFBXbm9aRVdXeVhkNGZZQkdEd05XVlppa1hCNTFtRGtJNCs2QWpLeUlsRmdXS2RXNDdwd2g1eEJ2NS9FMjdoNy8yTXd1TEttVE5iRlc1bS85dXBJeHRxUEovZlpibDFnLzY5ajF5SkRKR1lZOWdjZmRVWFBvZnhqbUZlMmY1ZWNNaGtQczJ6UjhTVTk4TWw2VHVUVnhTeEVwK2ZSZkVoRHVPY0RxdmhGbVZndmpHNUNyZkJNbmVrUjBjK2ZvUTk4MDR2VUdSS24rZGRNcXMwTkQyUjljc3pvTVZlTlI2MC9MVWN2L1dkWlZHbTkwZ2h4N3U5NTZiNSs0SUxqMHJmdFF6MlVnZVc4TVo1RXVNU0FhemlROWtkT0E5VTBxeVR2RkhXT01RVnJPczQ2Rkh4L29zTDJVRUswTWpBR2duODhqbFBXMWpWSlNody84TXRKU1pFUGhjYmJ3NUVzK25jR3JTd0ZEODM0QzF4bFY0cXU5WlFOZlBaNFNDWWpmTlVob2txTllUSE5wMG9jL1pwN3FZQktKRXY2VFdvZXRvNlB5THdQR2dORkM4WHpSOXU4VlZhMkhJd2ZDL1FuUWJISmRGVTFNZFNVVy9UWXMwK2J1VWRwN3NtaURxdUNaUzBjOVJTblVnVXFVTldXVTBjRzRqYjlxeW5hWWZPc1FwN0d3NjM0c3JTT0FkYURhZEN5SnBEbEhRUzR1Y050YnlEdkpocGg1L3NxUWw4cUZpZ2dLeFo1UjBPcFFhVi9YZzM5dmNQbDkyL3ZZbkVoc1BqNHVzN0E9PC9DaXBoZXJWYWx1ZT48L0NpcGhlckRhdGE+PC9FbmNyeXB0ZWRLZXk+PC9LZXlJbmZvPjxDaXBoZXJEYXRhPjxDaXBoZXJWYWx1ZT5IRDBmQlFLSDgzRWNxVHI0cmhvOUNLUy9XbEl4OHg5VGRDZWVaNHJTSVFha1h4SFdFOHJvbXd1Vlp2cG5hVlJoUUluSFdGSWlNM2VWL3Z1UHo3ZjFnZ3ZVbkdQY0xGR0xRU1RXVUNmYVZYWENub2JBSC9GYzBGbkRrNFlIajFIV0E0c3I2NVJwTXMvMzlyTXF4K2p2RTg0QVZKMTRMNjVNSGxaT0FYT0dyVlI5dnY5SFpyZlRTK3RwY2NSNHdlZVhEOW12ZGZYM0hQSmJHaFlnczhtR29nbXVOcTNjSC9NaWdLazc0MFYwOXYvSXVmZ1FId0NlS2dITHk5TTI2ai81VlhrYU5ZYnZ0WTRVYWJ2eVF3ZS81dVZhZ1J6SjVHM01PTjVXbDdwS0NhY05oaDM3SE1mbU1MNEF6VmpMeXZMZjRDSU9mazM5aCsrNjNtRkNOQ3R0WTV0M0hodUtaSGtZTFhhUEp5MTM0OEI2Zk0wU1N0TVVuV0VKeFBQeU14TTU0TmdlbThCN285Y25LajVoRmdiVUpocUhsZ0xQWUh1RFR1WG5hSGdubmVtZWYxWlJHWEZnMWJuSTZkdHhVdzk3ZHVweGdDSExja3IrME9FRUQ0T0hBZUdZaU9uWG9DUzZ4cXlCZGJjZVBzNEQwSnVzc2Q0VlVaZ2JsSHozNFRvRHB1V21tYzRVQnN6Yi9tREdiZjY1OG0rRTV2TU5vTDZGTE9mYzNha1k4ek85bXFnUUFHYjBzeHNYcHo1cEU2YXJTN2xLS1RzWjBBaDZYWm9oR3R5eklxYUt0RjVlQ3M3VE15dnlzNnE1TEpRVG5mLy90blptUmZSWE1Bdys4QmxZeWJRd2ZiTzhjYnlKQWtXZmQ5bmhQNW80VzZObFNrVTlScTNTb09Xai81MS9OQ2ZKa2o0VXRocTc5bGsvQmVuTG9mN1hJS1A0QWdlQVdsanVzSkw2WUNBYVhqVzM2Z2xIMG5id3BFTzhTNk9lT3VWWlNzVEJlZXJDMjNMQVRlYUhLR24zbTBHOFp2NDVET2I3dk5SNnpwOERYOFpvcEJmR1hEQjR4OWZxZHZFaDVSTHZHcHRmTjl2eEwrSTdWdFh4U2R2UzhMb1VXbUZIOXZlY09RSlBadXRscXlwSUJLVE1RR1lRUm93ZkcrVHloRXRQVlBCeG9xYWZxd3NkVXlMRG11RjFYMGV4L0hSUERJVjA4NjZlZXFPeVUrdEU0Nm5Yd2dKSG5uUTBXdmFpSFdWT0p2ZjdJRk0zekxiaHVPR0FwMkZSWkRKb0xraGcrWVFIRE4xbkQ4ZUtmcVZtMEU1d1NYOUFjdnI0SzQvOVorT01NWGZsZ1FhVHNITVV6WkJUamcybWlpWGZxWkdNVjVNQXB4cUlmcU9sTnV1dFBVMGxDUUE4L3diR3d2WU5VWFZ2TE82NUI4NGhiTnRwNFNrMXB0bFRQb3Z5TkRzQ3ZxVmMrWkVsN2hZNFNUQjR6OFJlYTZVQnhhWlhnUkFRSGh3OEl2QmlhS0NtZ3N5MWU4QThiS1I5blZmSzFMS2F3WE01RWpYVzdKWGN0akRvK0EvUG9PZnEwVjJ3VFh3eG41Mm5MVHFsNDNFenFrcjVqLzJrZHF5UHdqSU9DanNjTm96QnBucHlTVHRTSVdIbk53dDRYbzV4R3BqejZmYVpuY2lCYS9XcTQwdUpudWp2OFlvRnFkanc1c0FrWW90eFlhVkM5RVJuamRQQTVTWkNVb1hBdFZHay9WZ05FZndvNjRqUWw0S0tsWDZaWFk4RitqTStKaEMveWQ1SlQyUHp2RlNhNVpBYU1YRlRWMFNEVVIvcyt5OWZZckhxQk8xVjN6K1U2L2JGV201b1BtalFpclRBK1M0TDZHVnhRUjMzYVN1UWdGTC9qQVRqZHp0S2tKYkhTSi9EdG1iQnhJUWh0QWk3QzJaQXZiaGErUEtsWUlBVjFzVE1uVFpETE85Z2pjWFJHYmRZQWRVY0NPbS9nUjV2Q3lTQlBqWXQvUy85cEVnQkE0NksyQjRuc3RGa25ZbzJyYVFYbkdmZi95SHVqSGpSeThIVnM2amJaT0lXbC9JbmlHelZjek1IWnV6VXRRenVRSXFUTEhvaDNNWUVwWWkybkNUcVZSNE5mZ3BmcXowWTVUakNHS3EzRzZvZGJleXByd2JFaXdSNmVOYlY2cjRYTWJoQWhmM3BaQmNKdUdESXM2aW5uL3JtN0JGR2lPa3oreTBWMHVmK2plSjRMUGdzUlY5VGNVdlovNjN0QndWOUdjZ0hYczM1amxTQ0o2YmJET1BSOW1sS01pWHpGZEV2RGpwZHNxNFBlS0lpaHZ1OU9iNXBPTlRUWE5oNFBNOWV1aEIrVmRQMytPQ1RLQzR2NUJnbEpqYkdINjVzNzVPK2tJSDRJN1RJTlFVQlFCbUViaEJ5M3Vkc1dCMkgxYm10ZXgvKyswdk4xTWVRZUtuS0l1S2JhaDg3dHRDWmdkRGFxOGR1bWhxZHpUYXdPdkZyU1YvNlUrVXBLMGJmdnhKK3JJUWh2SWtBVVd5SkpodHc0eFc0MW5idndXVE1sS0k4b0xkazFDbkRSclFwR1RNUFNKTWwxTFN1Sld5dW82alZWeVdlK1JYSTFYVCs1QjhBYUEzR1h4OU80MFZ1T2VqL3J6VnVvd0k3RXNJenl4bWo4ZzVoc25Odmd5czgrN3JpNXdrSWhHNGRNNmNnaU1UZVZFbStpZndIUkxCMlZtQ0srR3M5QlFwWHZ0U3ptNTRoTGc0ZGNlRlZrYzhPT0NOWXNiakxnckdNRDllRUVwYllNeXAvcVFaRnBzMUQrN3B4eEhVbGxXQWdOQnRpeGJLRTRKZkozRnh3WlFXOFNBYzdYVTZZODVaeGsvTVRXL05uSlhNQTVTZGdYMlNYZUd4TXZ2ZjFyenpwdmFqdEhZWE5XM1ZHVDdCVlprUDVOZmlSSzZCUnU0R2RCcGpJbXhQalZWTFBrU3dpMWVYUnovd3NlcDQvTzVaK3l6S3N6djc2cXljbGtXcHVHUnpRdk9yWHY3WjFvc1VoRWVSN21NWnFZcFhBRnlPUWp1TC9rYjBNTWZKK2pSUTI5Zk9sQm1lZUs1YVF2c1ZYQUdhK1FtcWlGcCtiMEpuYlpEWFpjM1BMcG5FeElnVVJxUStPRUIya1dtR2lvSDBGWUo1V1BBVDJMUzJDdWhUWVdYWlJRN2pGNFBWem9LUkhLclpiaklBOWwyUWhrNmZPY2E0Uy9UL3RIazQ2VnpVNkc4WjVJT0xvUTJZeDBxTktGYTdYNlBXMEtINXk4aERtS1ZyYnUvTFVLVVN4R3pKSUlLOTdTQ1ZtVUJ1M1dwTWdMdlpvWnM4bDFZUUFLNEQvaTc1UEpkQkp1SnFSZmlxTndLVEUxR2pmbk5rQlRFOTFKcDkxcHV3c1JVeDR1RDlzUnl0WktROGpHenRLNVhQeTVCZk9PdGVHbUtZMmJOb2pSRjRnTTg0Rmx3anJVc3FQL0RLODZNdFdnekRQMXFDVDlDQmxWZWZEcHNJSVJ2WU1hQXVIREFnZnJlVnpvS0Zvc3BUUkdkYnRHdVpaQUJpR1U0Qy8yb042NEJBTWZHa1c4SCszMnlZdkJyUmUzZDgwQzdYL01wNTRrNWpFeGMrTzQvbG12Y3lXTFVHNkZLMzFUazQzQnJkQTFkQjRRMGg1dE14OW9wZlF1Q3htRGkyVThocEZlRXpXMk5pcDlJRmFZcmF0TlNWdng4RzJqbWxVQmRITEJuMDV5ODREdlJzTkVUVTMvek9BbHJkWU5HaTB4OTd6b2VtaVJPYWNkRUR2ZHdEbmc0WC9RUExqREEybjQwR2ppZFhCNlNpdURqeDhOSXdkMHlPSkN4UWNNSzlaVFk3azNlMHoxRlp4K2RTTHBHd0NoMEhhWlQ4VGh5QzU2UThmcm9uSWxITnlpakdBY0htcERlc3RFblFiN2dqanQ1blp2NCszN3E5MWVrcHl1bkM5bVVZa0JkQTMyckxrSkZNK20vR1VNTG9MOUlCRko3bHhZT2pLbm5NTE1OODEvVkd2eG9QVjF6SVFVMFViVHNCTnF3UW4zM0NrZjEwZzI5TDl0c0ZOVFhCeTQ0a1dvbXBPZGNJdHlLMmRGVXhia2lSQXE4alVNOXk4Vi9Xblg0MnJya1NmNmh2RjFXa2tsQS9obHRNTVZQYWNVNWNFY1FMODVqYUl3RDk3akVUakNQbnNUK0pNazQzTlJCMHQrWTZmNDJ2ZWJpcVdORUwxYktXb1dEVlNhZHpXZnd6YnpETndtUkdsclRMNWlqNXpKZUFyVzI2VXJHckRIY1dHUE9KbzdCVnY1V09XUFpmcDVZelRVa21xcmJMVWRqWTlmZmtNdHJpNUdrbCtGZytETnRQSTlINWFFWVJzZzR2TmVuOTFlcWFmczJPbndDd1k4bUtId1kvMjdvSDJ5dSt4M0RCcnFqSWZuRTh6RERyOG9jZ2RCRVZzUHU0ZU1lNUlEQVRJVUNJUHAvbEp5eTdRZjk2WWM3dHpMNFFRVTlsZmVLS1I3Q0FxOXNpd2NOblNjTjZKVllwUTVhK1VTV3BuUXhCYzFSa3lNRk9IaE9LaE9KL0RWQ3hyL0tDSThIZUx4ZllhN0lldUV0ZjFwNDMzSDFMdllFQzczSzVFT1haVGR4RENaNURzaHpsenk4MmlLclJFR042RTJwRFhLMERKYU90RjhKbU9xZ3NLWHJ3dHBhdU56U0lqNERxcXIzWHNkeGhxUWtVb3JwMWJVbEdFV3pCTEdTTFZDOUxhaXZVTVBnTUJ5RzBHQkxwNTYxSVpvZGpTclUralZyMU1jaVdyTUdkMWpmcEx6K0xpQnJrZ3lOcFN1enNsNjBNOTZOM0JmRUhHYjlITHlvNHM1K0w3UzBQMkdRRkJqK1lDZ1Bvc3Q4b1dTeUJqaTh3NytudGN5Q3d0cUExRGprdjRzOVdiSUdGV2d5eEV0V2V5UytDRWZXeHdHci9rK3JJN3lIL29RejNwanc0dmNvSEo1OENGYjUxRWZibmZNZnZNckcyMVEyOHFnaGkvakdHMy9LZElSWWc2L3NLajNHZ1BKWDJoSmJPV3paaC9qSXhrLzlhblZWQ1FQZkR3OXUzdWgwTG9rQ2JiRHM0c0tiais3R2RjV2hxelBJWFRUeGhORTB1WklBNlE3dnh1VjRmek1QNGZreGFEUVFpTTA1QzB3WUY4K1AxTUlXNmFjYmU5N3lXZzcvek9KTHZvV1I5ejJjcE1RTVBXZWJqZnM4bWVRUEJCTDMxdGFpMGs5aGNBTUw4RURLQnNOaisyMzVKdlU0NE1ERnV2VFVVQ29aWUZlZnpsU3JyeHVkN1MxU1ZoVmJyd2VDU1lWcXV5azlyU0Y1ZUxLOEVTQndsdFFTc05HV3grZFl3S3JYQlpZV09Qa2RWTVZUdzI3cHRZcHJ3RzFmVG1FUFVlQllBTFhlbHpKeHNiNU95dTRQZjZZSVpnaGtvUmg0OU1GbDFnWVpXVTRIc2FOVlE3WFNKTmZpWUtUZ2dpZmZVQVljMnprN3B2U1NsZnhXMFMxWDZmZWpJMmwxcVBuNlgzQlVuaTJVczlhSTlRSmtDQW9yR0FMVGU3ZE14ZExJdld2akNoTVdYTUUyQzVnbjA2eTdlSmQ2UjFLd2s4Wm5qcUdkUXJNWVk5RnE5cHlaN050OXFNSHZaRStka3h2cXQzYnpXL0svZ2NIaFJkbzdOWlRYREUwdkFGSnlMQXlERFQzeldBWW9jRW00SWZrVzdOOTVTdDBwNERNaUs5TE42L2VQU3I4MDJpUHdiVit6WXA3Q2kxZFczd3hVTjZySWNrdWJSZGpYNmlkUmNneENtbkNDTWFod0YzL0VNMWRFeE14UC85WXo5MkJObmRPNkM1WXlySlJuNWs0RGNwOVNuMEVmTGk4dk1rZlBBaUxoTzdGYy94c2dyYUYvcTRsclJwTnp0MVV0TkhXYVlwcFhYMTlwRUUyUXZoVnFDMDN0b0UvTDJDcHhsMDZSQ2xjQlRsSUo0MU5MRkorMXVJYWE0NmFHWWMzQWpUTnRtZDFtWklVQVUvSFlEcm1HRnV1NWZBVlEyYVBRYVowdGNrQy9kSDlmYzBuZCs5OUx5akpjSzlEcHZXRW8wVjVvNkRCZHlhUnJ4aHFiakk5a1Nic29NQkROank1d3NVMWUvb1NoOTJ1b0ZOcnk1dEhBWkZiTmNZb2xKS2dDdmFacVM2WWVOc29ubE1XUkd0bXhPM3A0T3V2MG8vckxDYmVZKzBLQU5SUnl5NFVQWUJobEhEdzVUaTIyZzdJd1llVEkwNGFCSGlaUXhVdUlQMmpEZXFTNnVKNEt1RTloc2l5ak9iSTh5TTh3bTQ3enhRSlBpRE94RW9IZzhyVVMvWVNDRDFDSkJrc2RVUTRWWXVOMlg3Mm95bjlwekxOZ1RRb3JBbmFFdVQ5QUloRzlUOGR2ZkRJVW5TZ2lvZVQwSUVwVThsSnFka2x5NGtNVWQ4UW44K3hlaXBkTnAwYlErbUlycXFPU0tYbHk1SmdXVlRNamdsTmllNVZIY2FPUHhoMGFpYVU4amZLbWExOVVFZ2NDQ0pwNGhRZWhTOWE4cFVkeXo5aHlrTzZLQ09Gd24yRVFJNVljM3dXSWYwNzhqeS9YblBFSjJPbE9Tb2ZzaTBJSk11MUxIVEt6T2xMa0pSOFE3SE9YY0N1OWRTZUVwUEZ2T1RyK3hlRmRlK2psMnFDWXErSjh4d3A5U3FzVThWRjhTU25kTm0yWjZLRXZ0ZXhMUGZ3VitnRHdKamlQTmhJdTA0TlF5NjBGbGNrUnFKL2I3bktpQkVhaUZsVnN4SVp4MTY1N0dKUGl0VjBYMkczbzdEenJiSnI3WFFFTDAxT2laUFFNbVY2cVZpQTNpbXNhM3lmOWpTb1ZjQjRVWmRCSk1sZnhIUDdqbTIxVmlFSmVxUCtoazBiQnNqbVpzT3lEVnM3NjFpUi9nT014SjJyUjNnVGxOVEdVdFU4TC9DbEJhWllGbzVaSUltbnc4TlpUVVppOGdXaDNsbklxZ1lrQ2xyK0RGVEVRN2FMM1R2cVQxdkg5bCtlZ1p4NmlzVGljSTdtc2NNZ2lUWWhQQlcvelVaVDh3UlVUMGpkZytna3FnajlGMUVYbU9zMnJDV0JnV2k4Q0wwRkZrM3Z4ZVdpNDB2K1IyL0tXb1JRTEF1cDdPdXdIdEtHbUFmMkRkOUsrT0ZFM2hZMHRrSkxnUFk1YVlhUUhRWXJrS0Q1bEVDelZEbUlBNVg5Y0hQenZsN0l1bGNoQWMyZWZVMVJXYU84clU1dkJtTGVUU2c3U0ZyNzZJL3NnTzVtOFZUZ1FPUnhsTWJaV1JjU0JGWXo4VmkrNlE4NjBVdjZEdnkvWTNNSGNLM28xMXJkcnUzOFR4SmphVmFaTEpxY2xGck9SOU5VL1JmTk02TmZQRXJIMEx1SVF4RityaVU3NUVxZ0tPZWNtMzBmbTNYYVhPYldLdVN6SXNIdUlWbU5YWVBLWkJrZ2RHTGhkeDBxREtEWXkvZEJUNk9NM3FweEdmTzhrWE82eTcwTVFRbXZXam9Ld3BQWEdka0VOSTQ3MkJldU82WWQyVlFaakVjb1VwSWhIaXRoZUEzZ0kzazg2L3Bsa3gxRVAySWNzbnd3UTREZjl2QUdkakNwOTZXaDdCNVlrZjZBejdvN1QraUMzQjF4SDV3ZjZJUEtTYUpDcWZRPC9DaXBoZXJWYWx1ZT48L0NpcGhlckRhdGE+PC9FbmNyeXB0ZWREYXRhPjwvc2FtbDpFbmNyeXB0ZWRBc3NlcnRpb24+PC9zYW1scDpSZXNwb25zZT4="
# this is the key of our dev env
private_key_str = "-----BEGIN RSA PRIVATE KEY-----\n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\n-----END RSA PRIVATE KEY-----\n"
# our code

message = Saml::Encoding.decode_64( saml_response )
request_or_response = Saml.parse_message(message, :response)
assertion = Saml::Util.decrypt_assertion(request_or_response.encrypted_assertion,  OpenSSL::PKey::RSA.new(private_key_str)) #this line raise error

puts assertion.to_xml

# One login code that works
require 'onelogin/ruby-saml'
saml_settings = OneLogin::RubySaml::Settings.new({:private_key => private_key_str })
response = OneLogin::RubySaml::Response.new( saml_response, :settings => saml_settings)
request_or_response = Saml.parse_message( response.decrypted_document.to_s, :response)
puts request_or_response.assertion.to_xml
